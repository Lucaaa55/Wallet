import { ActivityIndicator, Alert, Button, Dimensions, Image, NativeModules, RefreshControl, ScrollView, StatusBar, StyleSheet, Text, TextInput, TouchableOpacity, View } from 'react-native'
import { useEffect, useRef, useState } from 'react'
import { colors } from '$/extra/colors'
import { useRouter } from 'expo-router'
import * as Haptics from 'expo-haptics'
import { useNotes } from '@/hooks/useNotes'
import { ArrowDownLeft, ArrowUp, ArrowUpRight, BanknoteArrowDown, ChevronRight, Eye, EyeOff, Landmark, Link, MoveRight, Plus, QrCode, Scan, ScanQrCode, Search } from 'lucide-react-native'
import { Chat } from '@/types/include'
import ContextMenu from 'react-native-context-menu-view'
import { config } from '$/extra/config'
import { SafeAreaView } from 'react-native-safe-area-context'
import Flag from 'react-native-country-flag'
import Carousel, { ICarouselInstance, Pagination } from 'react-native-reanimated-carousel'
import { useSharedValue } from 'react-native-reanimated'

const data = [...new Array(3).keys()]

export default function Page() {
    const router = useRouter()

    const carouselRef = useRef<ICarouselInstance>(null)
    const progress = useSharedValue<number>(0)

    const onPressPagination = (index: number) => {
        carouselRef.current?.scrollTo({
            count: index - progress.value,
            animated: true,
        })
    }

    const [hide, setHide] = useState(false)
    const [amount, setAmount] = useState('0,01')
    const [growthPercentage, setGrowthPercentage] = useState('0')
    const [cotis, setCotis] = useState({
        compra: '1.480,00',
        venta: '1.420,00',
    })

    const [refreshing, setRefreshing] = useState(false)

    useEffect(() => {
        
    }, [])

    const onRefresh = () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)
        
        setRefreshing(true)
        setTimeout(() => {
            setRefreshing(false)
        }, 1500)
    }

    const Hide = () => {
        Haptics.selectionAsync()
        setHide(!hide)
    }

    const Datos = () => {
        Haptics.selectionAsync()
        router.push('/(ext)/datos')
    }

    const Links = () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)
    }

    const Qr = () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light)
    }

    const Ingresar = () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)
    }

    const Retirar = () => {
        Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)
    }

    return (
        <>
            <StatusBar barStyle={'default'} />

            <SafeAreaView style={styles.container}>
                <View style={styles.header}>
                    <Text style={styles.title}>Hola, {'Luca'}!</Text>
                    <View style={styles.headerButtons}>
                        <TouchableOpacity activeOpacity={0.8} onPress={Hide} style={styles.headerEyesContainer}>
                            <Scan size={20} strokeWidth={2} color={colors.black} />
                        </TouchableOpacity>
                        <TouchableOpacity activeOpacity={0.8} onPress={Hide} style={styles.headerEyesContainer}>
                            { hide ? <Eye size={20} strokeWidth={2} color={colors.black} /> : <EyeOff size={20} strokeWidth={2} color={colors.black} /> }
                        </TouchableOpacity>
                    </View>
                </View>

                <ScrollView nestedScrollEnabled={true} contentContainerStyle={styles.content} style={styles.scrollView} refreshControl={<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />}>
                    <View style={styles.view}>
                        <View style={styles.indicators}>
                            <View style={styles.indicator}>
                                <Text style={styles.indicatorText}>Balance</Text>
                            </View>
                            <TouchableOpacity activeOpacity={0.8} onPress={Datos} style={styles.indicatorEyeContainer}>
                                <Text style={styles.indicatorText}>Datos de la cuenta</Text>
                                <ChevronRight size={20} strokeWidth={2} color={colors.light} />
                            </TouchableOpacity>
                        </View>
                        <View style={styles.amountContainer}>
                            <Text style={styles.amount}>${hide ? '****' : amount}</Text>
                            <View style={styles.growthContainer}>
                                <ArrowUp size={15} strokeWidth={2} color={colors.growthGreen} />
                                <Text style={styles.growthText}>{growthPercentage}</Text>
                                <Text style={styles.growthPercentage}>%</Text>
                            </View>
                        </View>
                        <View style={styles.actions}>
                            <View style={styles.actionContainer}>
                                <TouchableOpacity activeOpacity={1} onPress={Ingresar} style={styles.action}>
                                    <Text style={styles.actionText}>Ingresar</Text>
                                </TouchableOpacity>
                            </View>
                            <View style={styles.actionContainer}>
                                <TouchableOpacity activeOpacity={1} onPress={Retirar} style={styles.action}>
                                    <Text style={styles.actionText}>Retirar</Text>
                                </TouchableOpacity>
                            </View>
                        </View>
                    </View>

                    {/* <View style={styles.actionButtons}>
                        <TouchableOpacity activeOpacity={0.8} onPress={Qr} style={styles.actionButton}>
                            <ScanQrCode size={20} strokeWidth={2} color={colors.gray} />
                            <Text style={styles.actionButtonText}>Pagar con QR</Text>
                        </TouchableOpacity>
                        <TouchableOpacity activeOpacity={0.8} onPress={Links} style={styles.actionButton}>
                            <Link size={20} strokeWidth={2} color={colors.gray} />
                            <Text style={styles.actionButtonText}>Links de pago</Text>
                        </TouchableOpacity>
                    </View>

                    <View style={styles.cotis}>
                        <View style={styles.cotisHeader}>
                            <Text style={styles.cotisHeaderText}>Cotizaciones</Text>
                        </View>
                        <View style={styles.cotisContent}>
                            <View style={[styles.cotisItem, {
                                marginLeft: 20,
                            }]}>
                                <Text style={styles.cotisItemText}>Compra</Text>
                                <Text style={styles.cotisItemValue}>{cotis.compra} ARS</Text>
                            </View>
                            <View style={[styles.cotisItem, {
                                marginRight: 20,
                            }]}>
                                <Text style={styles.cotisItemText}>Venta</Text>
                                <Text style={styles.cotisItemValue}>{cotis.venta} ARS</Text>
                            </View>
                        </View>
                    </View>

                    <ScrollView nestedScrollEnabled={true} style={styles.movementsScrollView} contentContainerStyle={styles.movementsContent}>
                        <Text>Hola</Text>
                        <Text>Hola</Text>
                        <Text>Hola</Text>
                        <Text>Hola</Text>
                        <Text>Hola</Text>
                        <Text>Hola</Text>
                    </ScrollView>

                    <Carousel 
                        ref={carouselRef}
                        data={data}
                        onProgressChange={progress}
                        renderItem={({ item }) => (
                            <View style={styles.carouselItem}>
                                <Text>{item}</Text>
                            </View>
                        )}
                        width={Dimensions.get('window').width * 0.9}
                        autoPlay
                        autoPlayInterval={2000}
                        height={100}
                    />

                    <Pagination.Basic
                        progress={progress}
                        dotStyle={{
                            backgroundColor: colors.soft,
                            borderRadius: 999,
                        }}
                        activeDotStyle={{
                            backgroundColor: colors.orange,
                            borderRadius: 999,
                        }}
                        containerStyle={{
                            gap: 10,
                            marginTop: 10,
                        }}
                        data={data}
                        onPress={onPressPagination}
                    /> */}
                </ScrollView>
            </SafeAreaView>
        </>
    )
}

const styles = StyleSheet.create({
    container: {
        display: 'flex',
        justifyContent: 'center',
        flexDirection: 'column',
        alignItems: 'center',
        backgroundColor: colors.back,
    },
    header: {
        width: '100%',
        display: 'flex',
        height: '9%',
        flexDirection: 'row',
        alignItems: 'flex-start',
        gap: 10,
        justifyContent: 'space-between',
    },
    headerButtons: {
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        marginTop: '4%',
    },
    headerEyesContainer: {
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        marginRight: 25,
    },
    title: {
        fontSize: 22,
        fontWeight: '500',
        color: colors.black,
        fontFamily: 'Aalto',
        marginLeft: 25,
        marginTop: '3%',
    },
    actions: {
        display: 'flex',
        flexDirection: 'row',
        width: '90%',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '10%',
    },
    actionContainer: {
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        gap: 5,
    },
    action: {
        width: 130,
        height: 50,
        borderRadius: 9999,
        backgroundColor: colors.back,
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
    },
    actionText: {
        fontSize: 18,
        fontWeight: '500',
        color: colors.darkGray,
    },
    view: {
        boxShadow: '0px 0px 12px rgba(0, 0, 0, 0.02)',
        width: '90%',
        height: '35%',
        borderRadius: 12,
        justifyContent: 'center',
        flexDirection: 'column',
        backgroundColor: colors.white,
        alignItems: 'center',
        gap: '15%',
    },
    scrollView: {
        flexGrow: 0,
        height: '100%',
        width: '100%',
        backgroundColor: colors.back,
    },
    content: {
        alignContent: 'center',
        alignItems: 'center',
        justifyContent: 'flex-start',
        display: 'flex',
        flexDirection: 'column',
        flex: 1,
        gap: '3%',
    },
    amount: {
        fontSize: 40,
        fontWeight: '600',
        color: colors.darkGray,
    },
    cotis: {
        width: '90%',
        gap: '5%',
        backgroundColor: colors.white,
        borderWidth: 1,
        borderColor: colors.border,
        height: 120,
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'center',
        borderRadius: 12,
    },
    indicators: {
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        width: '90%',
    },
    indicator: {},
    indicatorText: {
        fontSize: 15,
        fontWeight: '500',
        color: colors.gray,
    },
    indicatorEyeContainer: {
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        gap: 5,
    },
    amountContainer: {
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        gap: '2%',
        marginRight: 'auto',
        marginLeft: '5%',
    },
    amountSymbol: {
        fontSize: 20,
        fontWeight: '500',
        color: colors.black,
    },
    actionButtons: {
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'space-between',
        width: '90%',
    },
    actionButton: {
        width: '47.5%',
        height: 55,
        borderRadius: 6,
        backgroundColor: colors.soft,
        display: 'flex',
        flexDirection: 'row',
        gap: '5%',
        justifyContent: 'center',
        alignItems: 'center',
    },
    actionButtonText: {
        fontSize: 15.5,
        fontWeight: '600',
        color: colors.black,
    },
    growthContainer: {
        display: 'flex',
        flexDirection: 'row',
        alignItems: 'center',
        justifyContent: 'center',
        gap: 2,
        backgroundColor: colors.lightGreen,
        borderRadius: 9999,
        paddingHorizontal: 7,
        paddingVertical: 4,
    },
    growthText: {
        fontSize: 14,
        fontWeight: '500',
        color: colors.growthGreen,
    },
    growthPercentage: {
        fontSize: 14,
        fontWeight: '500',
        color: colors.growthGreen,
    },
    cotisHeader: {
        marginLeft: 20,
    },
    cotisHeaderText: {
        fontSize: 16,
        fontWeight: '500',
        color: colors.gray,
    },
    cotisContent: {
        width: '100%',
        display: 'flex',
        flexDirection: 'row',
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    cotisItem: {
        gap: '10%',
        display: 'flex',
        width: '40%',
        flexDirection: 'column',
        justifyContent: 'center',
        alignItems: 'flex-start',
    },
    cotisItemText: {
        fontSize: 16,
        fontWeight: '500',
        color: colors.black,
    },
    cotisItemValue: {
        fontSize: 20,
        fontWeight: '500',
        color: colors.growthGreen,
    },
    carouselItem: {
        width: '100%',
        height: '100%',
        backgroundColor: colors.red,
        borderRadius: 12,
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
    },
    flag: {
        borderRadius: 999,
        width: 20,
        height: 20,
    },
    movementsScrollView: {
        flexGrow: 0,
        height: Dimensions.get('window').height * 0.2,
        width: '90%',
        backgroundColor: colors.white,
        borderWidth: 1,
        borderColor: colors.border,
        borderRadius: 12,
    },
    movementsContent: {
        alignContent: 'center',
        alignItems: 'center',
        display: 'flex',
        flexDirection: 'column',
        flex: 1,
        gap: '3%',

    },
})